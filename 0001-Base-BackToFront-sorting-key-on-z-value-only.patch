From 186beaa99e9b2371fc754acad4da2215c2511e90 Mon Sep 17 00:00:00 2001
From: Laszlo Agocs <laszlo.agocs@qt.io>
Date: Mon, 16 Oct 2017 22:06:33 +0200
Subject: [PATCH] Base BackToFront sorting key on z value only

The x/y distance plays no role here.

Change-Id: I99030752060224540d4f48ce96aeaf782490dc51
---
 src/render/backend/renderview.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/render/backend/renderview.cpp b/src/render/backend/renderview.cpp
index 0731182..4498d29 100644
--- a/src/render/backend/renderview.cpp
+++ b/src/render/backend/renderview.cpp
@@ -596,7 +596,8 @@ QVector<RenderCommand *> RenderView::buildDrawRenderCommands(const QVector<Entit
             for (const RenderPassParameterData &passData : renderPassData) {
                 // Add the RenderPass Parameters
                 RenderCommand *command = new RenderCommand();
-                command->m_depth = m_data.m_eyePos.distanceToPoint(entity->worldBoundingVolume()->center());
+                // BackToFront and FrontToBack need a Z value to base the sort on.
+                command->m_depth = qAbs(m_data.m_eyePos.z() - entity->worldBoundingVolume()->center().z());
                 command->m_geometry = geometryHandle;
                 command->m_geometryRenderer = geometryRendererHandle;
                 command->m_material = materialHandle;
-- 
2.6.3.windows.1

